<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dongnao.workbench.finance.dao.AccountOperaTotalMapper">
	<resultMap id="BaseResultMap" type="com.dongnao.workbench.finance.model.AccountOperaTotal">
		<id column="id" property="id" jdbcType="VARCHAR" />
		<result column="store_id" property="storeId" jdbcType="VARCHAR" />
		<result column="store_name" property="storeName" jdbcType="VARCHAR" />
		<result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
		<result column="invalid_num" property="invalidNum" jdbcType="INTEGER" />
		<result column="valid_num" property="validNum" jdbcType="INTEGER" />
		<result column="product_sale_amount" property="productSaleAmount" jdbcType="VARCHAR" />
		<result column="amount_receivable" property="amountReceivable" jdbcType="VARCHAR" />
		<result column="amount_payable" property="amountPayable" jdbcType="VARCHAR" />
		<result column="cyz_service_charge" property="cyzServiceCharge" jdbcType="VARCHAR" />
		<result column="sale_gross_profit" property="saleGrossProfit" jdbcType="VARCHAR" />
		<result column="dist_price" property="distPrice" jdbcType="VARCHAR" />
		<result column="dist_all" property="distAll" jdbcType="VARCHAR" />
		<result column="dist_diff" property="distDiff" jdbcType="VARCHAR" />
		<result column="actual_merchant_dist_charge" property="actualMerchantDistCharge" jdbcType="VARCHAR" />
		<result column="platform_activities_charge" property="platformActivitiesCharge" jdbcType="VARCHAR" />
		<result column="service_all" property="serviceAll" jdbcType="VARCHAR" />
		<result column="other_all" property="otherAll" jdbcType="VARCHAR" />
		<result column="profit_all" property="profitAll" jdbcType="VARCHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="platform_type" property="platformType" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
	 	id,
		store_id,
		store_name,
		create_date,
		invalid_num,
		valid_num,
		product_sale_amount,
		amount_receivable,
		amount_payable,
		cyz_service_charge,
		sale_gross_profit,
		dist_price,
		dist_all,
		dist_diff,
		actual_merchant_dist_charge,
		platform_activities_charge,
		service_all,
		other_all,
		profit_all,
		remark,
		platform_type
	</sql>
	
	<!--查看浅运营表 -->
	<select id="listSimpleTotalByCondition" resultMap="BaseResultMap" parameterType="com.dongnao.workbench.finance.model.AccountOperaTotal">
		select
			id,
			store_id,
			store_name,
			create_date,
			sum(invalid_num) as invalid_num,
			sum(valid_num) as valid_num,
			sum(product_sale_amount) as product_sale_amount,
			sum(amount_receivable) as amount_receivable,
			sum(amount_payable) as amount_payable,
			sum(cyz_service_charge) as cyz_service_charge,
			sum(sale_gross_profit) as sale_gross_profit,
			sum(dist_price) as dist_price,
			sum(dist_all) as dist_all,
			sum(dist_diff) as dist_diff,
			sum(actual_merchant_dist_charge) as actual_merchant_dist_charge,
			sum(platform_activities_charge) as platform_activities_charge,
			sum(service_all) as service_all,
			sum(other_all) as other_all,
			sum(profit_all) as profit_all,
			remark,
			platform_type
		from account_opera_simple_total
		where 1=1
		<if test="id != null and '' != id">  
			and id = #{id,jdbcType=VARCHAR}
		</if>
		<if test="storeId != null and '' != storeId">  
			and store_id = #{storeId,jdbcType=VARCHAR}
		</if>
		<if test="storeName != null and '' != storeName">  
			and store_name = #{storeName,jdbcType=VARCHAR}
		</if>
		<if test="createDate != null and '' != createDate">  
			and create_date = #{createDate,jdbcType=TIMESTAMP}
		</if>
		<if test="invalidNum != null and '' != invalidNum">  
			and invalid_num = #{invalidNum,jdbcType=INTEGER}
		</if>
		<if test="validNum != null and '' != validNum">  
			and valid_num = #{validNum,jdbcType=INTEGER}
		</if>
		<if test="productSaleAmount != null and '' != productSaleAmount">  
			and product_sale_amount = #{productSaleAmount,jdbcType=VARCHAR}
		</if>
		<if test="amountReceivable != null and '' != amountReceivable">  
			and amount_receivable = #{amountReceivable,jdbcType=VARCHAR}
		</if>
		<if test="amountPayable != null and '' != amountPayable">  
			and amount_payable = #{amountPayable,jdbcType=VARCHAR}
		</if>
		<if test="cyzServiceCharge != null and '' != cyzServiceCharge">  
			and cyz_service_charge = #{cyzServiceCharge,jdbcType=VARCHAR}
		</if>
		<if test="saleGrossProfit != null and '' != saleGrossProfit">  
			and sale_gross_profit = #{saleGrossProfit,jdbcType=VARCHAR}
		</if>
		<if test="distPrice != null and '' != distPrice">  
			and dist_price = #{distPrice,jdbcType=VARCHAR}
		</if>
		<if test="distAll != null and '' != distAll">  
			and dist_all = #{distAll,jdbcType=VARCHAR}
		</if>
		<if test="distDiff != null and '' != distDiff">  
			and dist_diff = #{distDiff,jdbcType=VARCHAR}
		</if>
		<if test="actualMerchantDistCharge != null and '' != actualMerchantDistCharge">  
			and actual_merchant_dist_charge = #{actualMerchantDistCharge,jdbcType=VARCHAR}
		</if>
		<if test="platformActivitiesCharge != null and '' != platformActivitiesCharge">  
			and platform_activities_charge = #{platformActivitiesCharge,jdbcType=VARCHAR}
		</if>
		<if test="serviceAll != null and '' != serviceAll">  
			and service_all = #{serviceAll,jdbcType=VARCHAR}
		</if>
		<if test="otherAll != null and '' != otherAll">  
			and other_all = #{otherAll,jdbcType=VARCHAR}
		</if>
		<if test="profitAll != null and '' != profitAll">  
			and profit_all = #{profitAll,jdbcType=VARCHAR}
		</if>
		<if test="remark != null and '' != remark">  
			and remark = #{remark,jdbcType=VARCHAR}
		</if>
		<if test="platformType != null and '' != platformType">  
			and platform_type = #{platformType,jdbcType=VARCHAR}
		</if>
		<if test="orderFields != null and '' != orderFields">  
           	order by ${orderFields} ${order}
       	</if>
       	<if test="storeName != null and '' != storeName">  
       		GROUP BY store_name
       	</if>
	</select>
	<!--查看深运营表 -->
	<select id="listDeepTotalByCondition" resultMap="BaseResultMap" parameterType="com.dongnao.workbench.finance.model.AccountOperaTotal">
		select
			id,
			store_id,
			store_name,
			create_date,
			sum(invalid_num) as invalid_num,
			sum(valid_num) as valid_num,
			sum(product_sale_amount) as product_sale_amount,
			sum(amount_receivable) as amount_receivable,
			sum(amount_payable) as amount_payable,
			sum(cyz_service_charge) as cyz_service_charge,
			sum(sale_gross_profit) as sale_gross_profit,
			sum(dist_price) as dist_price,
			sum(dist_all) as dist_all,
			sum(dist_diff) as dist_diff,
			sum(actual_merchant_dist_charge) as actual_merchant_dist_charge,
			sum(platform_activities_charge) as platform_activities_charge,
			sum(service_all) as service_all,
			sum(other_all) as other_all,
			sum(profit_all) as profit_all,
			remark,
			platform_type
		from account_opera_deep_total
		where 1=1
		<if test="id != null and '' != id">  
			and id = #{id,jdbcType=VARCHAR}
		</if>
		<if test="storeId != null and '' != storeId">  
			and store_id = #{storeId,jdbcType=VARCHAR}
		</if>
		<if test="storeName != null and '' != storeName">  
			and store_name = #{storeName,jdbcType=VARCHAR}
		</if>
		<if test="createDate != null and '' != createDate">  
			and create_date = #{createDate,jdbcType=TIMESTAMP}
		</if>
		<if test="invalidNum != null and '' != invalidNum">  
			and invalid_num = #{invalidNum,jdbcType=INTEGER}
		</if>
		<if test="validNum != null and '' != validNum">  
			and valid_num = #{validNum,jdbcType=INTEGER}
		</if>
		<if test="productSaleAmount != null and '' != productSaleAmount">  
			and product_sale_amount = #{productSaleAmount,jdbcType=VARCHAR}
		</if>
		<if test="amountReceivable != null and '' != amountReceivable">  
			and amount_receivable = #{amountReceivable,jdbcType=VARCHAR}
		</if>
		<if test="amountPayable != null and '' != amountPayable">  
			and amount_payable = #{amountPayable,jdbcType=VARCHAR}
		</if>
		<if test="cyzServiceCharge != null and '' != cyzServiceCharge">  
			and cyz_service_charge = #{cyzServiceCharge,jdbcType=VARCHAR}
		</if>
		<if test="saleGrossProfit != null and '' != saleGrossProfit">  
			and sale_gross_profit = #{saleGrossProfit,jdbcType=VARCHAR}
		</if>
		<if test="distPrice != null and '' != distPrice">  
			and dist_price = #{distPrice,jdbcType=VARCHAR}
		</if>
		<if test="distAll != null and '' != distAll">  
			and dist_all = #{distAll,jdbcType=VARCHAR}
		</if>
		<if test="distDiff != null and '' != distDiff">  
			and dist_diff = #{distDiff,jdbcType=VARCHAR}
		</if>
		<if test="actualMerchantDistCharge != null and '' != actualMerchantDistCharge">  
			and actual_merchant_dist_charge = #{actualMerchantDistCharge,jdbcType=VARCHAR}
		</if>
		<if test="platformActivitiesCharge != null and '' != platformActivitiesCharge">  
			and platform_activities_charge = #{platformActivitiesCharge,jdbcType=VARCHAR}
		</if>
		<if test="serviceAll != null and '' != serviceAll">  
			and service_all = #{serviceAll,jdbcType=VARCHAR}
		</if>
		<if test="otherAll != null and '' != otherAll">  
			and other_all = #{otherAll,jdbcType=VARCHAR}
		</if>
		<if test="profitAll != null and '' != profitAll">  
			and profit_all = #{profitAll,jdbcType=VARCHAR}
		</if>
		<if test="remark != null and '' != remark">  
			and remark = #{remark,jdbcType=VARCHAR}
		</if>
		<if test="platformType != null and '' != platformType">  
			and platform_type = #{platformType,jdbcType=VARCHAR}
		</if>
		<if test="orderFields != null and '' != orderFields">  
           	order by ${orderFields} ${order}
       	</if>
        <if test="storeName != null and '' != storeName">  
       		GROUP BY store_name
       	</if>
	</select>
	
	
	<!--删除浅运营数据 -->	
	<delete id="deleteSimpleTotalByOperaDate" parameterType="com.dongnao.workbench.finance.model.OperaDate">
		delete from account_opera_simple_total
		where store_name like CONCAT('%',#{storeName,jdbcType=VARCHAR},'%')
		<if test="null != propsMap.startDate and propsMap.startDate != ''">
			<![CDATA[
			and DATE_FORMAT(create_date,'%Y-%c-%d') >= DATE_FORMAT(#{propsMap.startDate,jdbcType=DATE},'%Y-%c-%d')
			]]>
		</if>
		<if test="null != propsMap.endDate and propsMap.endDate != ''">
			<![CDATA[
			and DATE_FORMAT(create_date,'%Y-%c-%d') <= DATE_FORMAT(#{propsMap.endDate,jdbcType=DATE},'%Y-%c-%d')
			]]>
		</if> 
		<if test="platformType != null and '' != platformType">  
			and platform_type = #{platformType,jdbcType=VARCHAR}
		</if>
	</delete>
	<!--删除深运营数据 -->	
	<delete id="deleteDeepTotalByOperaDate" parameterType="com.dongnao.workbench.finance.model.OperaDate">
		delete from account_opera_deep_total
		where store_name like CONCAT('%',#{storeName,jdbcType=VARCHAR},'%')
		<if test="null != propsMap.startDate and propsMap.startDate != ''">
			<![CDATA[
			and DATE_FORMAT(create_date,'%Y-%c-%d') >= DATE_FORMAT(#{propsMap.startDate,jdbcType=DATE},'%Y-%c-%d')
			]]>
		</if>
		<if test="null != propsMap.endDate and propsMap.endDate != ''">
			<![CDATA[
			and DATE_FORMAT(create_date,'%Y-%c-%d') <= DATE_FORMAT(#{propsMap.endDate,jdbcType=DATE},'%Y-%c-%d')
			]]>
		</if> 
		<if test="platformType != null and '' != platformType">  
			and platform_type = #{platformType,jdbcType=VARCHAR}
		</if>
	</delete>
	
	
	<!-- 生成浅运营表 -->
	<insert id="addSimpleTotalByOperaDate" parameterType="com.dongnao.workbench.finance.model.OperaDate">
		INSERT INTO account_opera_simple_total (
			<include refid="Base_Column_List" />
		)(
			SELECT
				CONCAT(create_date,store_name) as id,
				store_id,
				store_name,
				create_date,
				invalid_num,
				valid_num,
				product_sale_amount,
				amount_receivable,
				amount_payable,
				cyz_service_charge,
				sale_gross_profit,
				dist_price,
				dist_all,
				dist_diff,
				actual_merchant_dist_charge,
				platform_activities_charge,
				service_all,
				other_all,
				profit_all,
				remark,
				platform_type
			FROM
				opera_date_base_price
			WHERE
				1 = 1
			GROUP BY
				store_name,
				create_date
			)
			UNION(		
			SELECT
				CONCAT(create_date,store_name) as id,
				store_id,
				store_name,
				create_date,
				invalid_num,
				valid_num,
				product_sale_amount,
				amount_receivable,
				amount_payable,
				cyz_service_charge,
				sale_gross_profit,
				dist_price,
				dist_all,
				dist_diff,
				actual_merchant_dist_charge,
				platform_activities_charge,
				service_all,
				other_all,
				profit_all,
				remark,
				platform_type
			FROM
				opera_date_platform_account
			WHERE
				1 = 1
			GROUP BY
				store_name,
				create_date
			)
			UNION(
			SELECT
				CONCAT(create_date,store_name) as id,
				store_id,
				store_name,
				create_date,
				invalid_num,
				valid_num,
				product_sale_amount,
				amount_receivable,
				amount_payable,
				cyz_service_charge,
				sale_gross_profit,
				dist_price,
				dist_all,
				dist_diff,
				actual_merchant_dist_charge,
				platform_activities_charge,
				service_all,
				other_all,
				profit_all,
				remark,
				platform_type
			FROM
				opera_date_sale_rate
			WHERE
				1 = 1
			GROUP BY
				store_name,
				create_date
			)
	</insert>
	<!-- 生成深运营表 -->
	<insert id="addDeepTotalByOperaDate" parameterType="com.dongnao.workbench.finance.model.OperaDate">
		INSERT INTO account_opera_deep_total (
		<include refid="Base_Column_List" />
		)(
			SELECT
				CONCAT(create_date,store_name) as id,
				store_id,
				store_name,
				create_date,
				invalid_num,
				valid_num,
				product_sale_amount,
				amount_receivable,
				amount_payable,
				cyz_service_charge,
				sale_gross_profit,
				dist_price,
				dist_all,
				dist_diff,
				actual_merchant_dist_charge,
				platform_activities_charge,
				service_all,
				other_all,
				profit_all,
				remark,
				platform_type
			FROM
				opera_date_sale_rate
			WHERE
				1 = 1
			GROUP BY
				store_name,
				create_date
		)
	</insert>
	
	<!-- 修改浅运营表 -->
	<update id="updateSimpleTotal" parameterType="com.dongnao.workbench.finance.model.AccountOperaTotal">
		update account_opera_simple_total  set
			id= #{id,jdbcType=VARCHAR}
			<if test="storeName != null and '' != storeName">  
			,store_name = #{storeName,jdbcType=VARCHAR}
			</if>
			<if test="createDate != null and '' != createDate">  
			,create_date = #{createDate,jdbcType=TIMESTAMP}
			</if>
			<if test="invalidNum != null and '' != invalidNum">  
			,invalid_num = #{invalidNum,jdbcType=INTEGER}
			</if>
			<if test="validNum != null and '' != validNum">  
			,valid_num = #{validNum,jdbcType=INTEGER}
			</if>
			<if test="productSaleAmount != null and '' != productSaleAmount">  
			,product_sale_amount = #{productSaleAmount,jdbcType=VARCHAR}
			</if>
			<if test="amountReceivable != null and '' != amountReceivable">  
			,amount_receivable = #{amountReceivable,jdbcType=VARCHAR}
			</if>
			<if test="amountPayable != null and '' != amountPayable">  
			,amount_payable = #{amountPayable,jdbcType=VARCHAR}
			</if>
			<if test="cyzServiceCharge != null and '' != cyzServiceCharge">  
			,cyz_service_charge = #{cyzServiceCharge,jdbcType=VARCHAR}
			</if>
			<if test="saleGrossProfit != null and '' != saleGrossProfit">  
			,sale_gross_profit = #{saleGrossProfit,jdbcType=VARCHAR}
			</if>
			<if test="distPrice != null and '' != distPrice">  
			,dist_price = #{distPrice,jdbcType=VARCHAR}
			</if>
			<if test="distAll != null and '' != distAll">  
			,dist_all = #{distAll,jdbcType=VARCHAR}
			</if>
			<if test="distDiff != null and '' != distDiff">  
			,dist_diff = #{distDiff,jdbcType=VARCHAR}
			</if>
			<if test="actualMerchantDistCharge != null and '' != actualMerchantDistCharge">  
			,actual_merchant_dist_charge = #{actualMerchantDistCharge,jdbcType=VARCHAR}
			</if>
			<if test="platformActivitiesCharge != null and '' != platformActivitiesCharge">  
			,platform_activities_charge = #{platformActivitiesCharge,jdbcType=VARCHAR}
			</if>
			<if test="serviceAll != null and '' != serviceAll">  
			,service_all = #{serviceAll,jdbcType=VARCHAR}
			</if>
			<if test="profitAll != null and '' != profitAll">  
			,profit_all = #{profitAll,jdbcType=VARCHAR}
			</if>
			<if test="otherAll != null and '' != otherAll">  
			,other_all = #{otherAll,jdbcType=VARCHAR}
			</if>
			<if test="remark != null and '' != remark">  
			,remark = #{remark,jdbcType=VARCHAR}
			</if>
			<if test="platformType != null and '' != platformType">  
			,platform_type = #{platformType,jdbcType=VARCHAR}
			</if>
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<!-- 修改深运营表 -->
	<update id="updateDeepTotal" parameterType="com.dongnao.workbench.finance.model.AccountOperaTotal">
		update account_opera_deep_total set
			id= #{id,jdbcType=VARCHAR}
			<if test="storeName != null and '' != storeName">  
			,store_name = #{storeName,jdbcType=VARCHAR}
			</if>
			<if test="createDate != null and '' != createDate">  
			,create_date = #{createDate,jdbcType=TIMESTAMP}
			</if>
			<if test="invalidNum != null and '' != invalidNum">  
			,invalid_num = #{invalidNum,jdbcType=INTEGER}
			</if>
			<if test="validNum != null and '' != validNum">  
			,valid_num = #{validNum,jdbcType=INTEGER}
			</if>
			<if test="productSaleAmount != null and '' != productSaleAmount">  
			,product_sale_amount = #{productSaleAmount,jdbcType=VARCHAR}
			</if>
			<if test="amountReceivable != null and '' != amountReceivable">  
			,amount_receivable = #{amountReceivable,jdbcType=VARCHAR}
			</if>
			<if test="amountPayable != null and '' != amountPayable">  
			,amount_payable = #{amountPayable,jdbcType=VARCHAR}
			</if>
			<if test="cyzServiceCharge != null and '' != cyzServiceCharge">  
			,cyz_service_charge = #{cyzServiceCharge,jdbcType=VARCHAR}
			</if>
			<if test="saleGrossProfit != null and '' != saleGrossProfit">  
			,sale_gross_profit = #{saleGrossProfit,jdbcType=VARCHAR}
			</if>
			<if test="distPrice != null and '' != distPrice">  
			,dist_price = #{distPrice,jdbcType=VARCHAR}
			</if>
			<if test="distAll != null and '' != distAll">  
			,dist_all = #{distAll,jdbcType=VARCHAR}
			</if>
			<if test="distDiff != null and '' != distDiff">  
			,dist_diff = #{distDiff,jdbcType=VARCHAR}
			</if>
			<if test="actualMerchantDistCharge != null and '' != actualMerchantDistCharge">  
			,actual_merchant_dist_charge = #{actualMerchantDistCharge,jdbcType=VARCHAR}
			</if>
			<if test="platformActivitiesCharge != null and '' != platformActivitiesCharge">  
			,platform_activities_charge = #{platformActivitiesCharge,jdbcType=VARCHAR}
			</if>
			<if test="serviceAll != null and '' != serviceAll">  
			,service_all = #{serviceAll,jdbcType=VARCHAR}
			</if>
			<if test="profitAll != null and '' != profitAll">  
			,profit_all = #{profitAll,jdbcType=VARCHAR}
			</if>
			<if test="otherAll != null and '' != otherAll">  
			,other_all = #{otherAll,jdbcType=VARCHAR}
			</if>
			<if test="remark != null and '' != remark">  
			,remark = #{remark,jdbcType=VARCHAR}
			</if>
			<if test="platformType != null and '' != platformType">  
			,platform_type = #{platformType,jdbcType=VARCHAR}
			</if>
		where id = #{id,jdbcType=VARCHAR}
	</update>
</mapper>
